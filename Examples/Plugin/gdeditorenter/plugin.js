(function(){CKEDITOR.plugins.add("gdeditorenter",{init:function(n){n.addCommand("enterKey",new CKEDITOR.EnterKey);n.addCommand("shiftEnterKey",new CKEDITOR.ShiftEnterKey);n.setKeystroke([[CKEDITOR.plugins.key.Enter,"enterKey"],[CKEDITOR.SHIFT+CKEDITOR.plugins.key.Enter,"shiftEnterKey"]])}});var n=CKEDITOR.dom.walker.whitespaces(),t=CKEDITOR.dom.walker.bookmark();CKEDITOR.EnterKey=function(){};CKEDITOR.EnterKey.prototype={insertParagraph:function(i,r,u,f){var y,et,ot,at,p,nt,vt,a;if(u=u||CKEDITOR.plugins.keyHelper.getRange(i),u){u=CKEDITOR.plugins.keyHelper.replaceRangeByEditableRoot(u);var b=u.document,yt=u.checkStartOfBlock(),st=u.checkEndOfBlock(),tt=i.elementPath(u.startContainer),e=tt.block,it=r===CKEDITOR.ENTER_DIV?"div":"p",o;if(yt&&st){if(e&&(e.is("li")||e.getParent().is("li"))){e.is("li")||(e=e.getParent());var l=e.getParent(),k=l.getParent(),v=!e.hasPrevious(),w=!e.hasNext(),ht=i.getSelection(),pt=ht.createBookmarks(),ct=e.getDirection(1),rt=e.getAttribute("class"),ut=e.getAttribute("style"),lt=k.getDirection(1)!==ct,wt=i.enterMode,bt=wt!==CKEDITOR.ENTER_BR||lt||ut||rt,d;if(k.is("li"))v||w?(v&&w&&l.remove(),e[w?"insertAfter":"insertBefore"](k)):e.breakParent(k);else if(bt)tt.block.is("li")?(o=b.createElement(r===CKEDITOR.ENTER_P?"p":"div"),lt&&o.setAttribute("dir",ct),ut&&o.setAttribute("style",ut),rt&&o.setAttribute("class",rt),e.moveChildren(o)):o=tt.block,v||w?o[v?"insertBefore":"insertAfter"](l):(e.breakParent(l),o.insertAfter(l)),e.remove();else{if(e.appendBogus(!0),v||w)while(d=e[v?"getFirst":"getLast"]())d[v?"insertBefore":"insertAfter"](l);else for(e.breakParent(l);d=e.getLast();)d.insertAfter(l);e.remove()}ht.selectBookmarks(pt);return}if(e&&e.getParent().is("blockquote")){e.breakParent(e.getParent());e.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||e.getPrevious().remove();e.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||e.getNext().remove();u.moveToElementEditStart(e);u.select();return}}else if(e&&e.is("pre")&&!st){this.insertLineBreak(i,r,u,f);return}if(y=u.splitBlock(it,i.config.dipCloneWithId),y){var h=y.previousBlock,c=y.nextBlock,ft=y.wasStartOfBlock,g=y.wasEndOfBlock,s;if(c?(s=c.getParent(),s.is("li")&&(c.breakParent(s),c.move(c.getNext(),1))):h&&(s=h.getParent())&&s.is("li")&&(h.breakParent(s),s=h.getNext(),u.moveToElementEditStart(s),h.move(h.getPrevious())),ft||g){if(h?!h.is("li")&&(CKEDITOR.plugins.keyHelper.headerTagRegex.test(h.getName())||h.is("pre"))||(o=h.clone()):c&&(o=c.clone()),o?f&&!o.is("li")&&o.renameNode(it):s&&s.is("li")?o=s:(o=b.createElement(it),h&&(at=h.getDirection())&&o.setAttribute("dir",at)),p=y.elementPath,p)for(nt=0,vt=p.elements.length;nt<vt;nt++){if(a=p.elements[nt],a.equals(p.block)||a.equals(p.blockLimit))break;CKEDITOR.dtd.$removeEmpty[a.getName()]&&(a=a.clone(),o.moveChildren(a),o.append(a))}o.appendBogus();o.getParent()||u.insertNode(o);o.is("li")&&o.removeAttribute("value");CKEDITOR.env.ie&&ft&&(!g||!h.getChildCount())&&(u.moveToElementEditStart(g?h:o),u.select());u.moveToElementEditStart(ft&&!g?c:o)}else c.is("li")&&(et=u.clone(),et.selectNodeContents(c),ot=new CKEDITOR.dom.walker(et),ot.evaluator=function(i){return!(t(i)||n(i)||i.type===CKEDITOR.NODE_ELEMENT&&i.getName()in CKEDITOR.dtd.$inline&&!(i.getName()in CKEDITOR.dtd.$empty))},s=ot.next(),s&&s.type===CKEDITOR.NODE_ELEMENT&&s.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?b.createElement("br"):b.createText(" ")).insertBefore(s)),c&&u.moveToElementEditStart(c);u.select();u.scrollIntoView()}}},insertLineBreak:function(n,t,i,r){var o,l,e;if(i=i||CKEDITOR.plugins.keyHelper.getRange(n),i){var f=i.document,c=i.checkEndOfBlock(),s=new CKEDITOR.dom.elementPath(n.getSelection().getStartElement()),u=s.block,h=u&&s.block.getName();if(!r&&h==="li"){this.insertParagraph(n,t,i,r);return}!r&&c&&CKEDITOR.plugins.keyHelper.headerTagRegex.test(h)?(l=u.getDirection())?(o=f.createElement("div"),o.setAttribute("dir",l),o.insertAfter(u),i.setStart(o,0)):(f.createElement("br").insertAfter(u),CKEDITOR.env.gecko&&f.createText("").insertAfter(u),i.setStartAt(u.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START)):(e=h==="pre"&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?f.createText("\r"):f.createElement("br"),i.deleteContents(),i.insertNode(e),CKEDITOR.env.needsBrFiller?(f.createText("﻿").insertAfter(e),c&&(u||s.blockLimit).appendBogus(),e.getNext().$.nodeValue="",i.setStartAt(e.getNext(),CKEDITOR.POSITION_AFTER_START)):i.setStartAt(e,CKEDITOR.POSITION_AFTER_END));i.collapse(!0);i.select();i.scrollIntoView()}},exec:function(n,t,i){if(t=n.config.forceEnterMode||t,n.mode==="wysiwyg"){i||(i=n.activeEnterMode);const r=n.elementPath();r&&!r.isContextFor("p")&&(i=CKEDITOR.ENTER_BR,t=CKEDITOR.ENTER_P);n.fire("saveSnapshot");i===CKEDITOR.ENTER_BR?this.insertLineBreak(n,i,null,t):this.insertParagraph(n,i,null,t);n.fire("saveSnapshot")}}};CKEDITOR.ShiftEnterKey=function(){};CKEDITOR.ShiftEnterKey.prototype={exec:function(n){return CKEDITOR.EnterKey.exec(n,n.activeShiftEnterMode,1)}};CKEDITOR.tools.extend(CKEDITOR.config,{dipCloneWithId:!0});CKEDITOR.plugins.keyHelper={headerTagRegex:/^h[1-6]$/,getRange:function(n){const t=n.getSelection().getRanges(!0);for(let n=t.length-1;n>0;n--)t[n].deleteContents();return t[0]},replaceRangeByEditableRoot:function(n){const t=n.startContainer.getAscendant(function(n){return n.type===CKEDITOR.NODE_ELEMENT&&n.getAttribute("contenteditable")==="true"},!0);if(n.root.equals(t))return n;const i=new CKEDITOR.dom.range(t);return i.moveToRange(n),i}}})();