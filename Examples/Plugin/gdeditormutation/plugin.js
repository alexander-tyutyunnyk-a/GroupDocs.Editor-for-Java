"use strict";(function(){function n(n){const f=function(n,t){return n.reduce(function(n,i){return(n[i[t]]=n[i[t]]||[]).push(i),n},{})},e=function(n){return n.reduce(function(n,t){return t.addedNodes.length>0&&t.addedNodes.forEach(function(t){t=new CKEDITOR.dom.node(t);(n.addedNodes=n.addedNodes||[]).push(t);n.addedNodes=n.addedNodes.concat(t.getAllChildNodes())}),t.removedNodes.length>0&&t.removedNodes.forEach(function(t){t=new CKEDITOR.dom.node(t);(n.removedNodes=n.removedNodes||[]).push(t);n.removedNodes=n.removedNodes.concat(t.getAllChildNodes())}),n},{})},i=f(n,"type"),r=i.attributes;if(r){const n=r[r.length-1],t=new CKEDITOR.dom.node(n.target).getPage();CKEDITOR.MutationRepo.runCommandByTagName(CKEDITOR.MutationRepoType.attributes,"*",t)}const u=i.characterData;if(u){const n=u[u.length-1],t=new CKEDITOR.dom.node(n.target).getPage();CKEDITOR.MutationRepo.runCommandByTagName(CKEDITOR.MutationRepoType.characterData,"*",t)}const t=i.childList;if(t){const n=e(t),i=function(n){return function(t){const i=n.filter(n=>n.equals(t));return i.length===0}};if(n.removedNodes){const t=n.addedNodes?n.removedNodes.filter(i(n.addedNodes)):n.removedNodes;t&&t.forEach(function(n){n.type!==3&&CKEDITOR.MutationRepo.runCommandByTagName(CKEDITOR.MutationRepoType.childListRemove,n.getName(),n)})}n.addedNodes&&n.addedNodes.forEach(function(n){n.type!==3&&CKEDITOR.MutationRepo.runCommandByTagName(CKEDITOR.MutationRepoType.childListAdd,n.getName(),n)});const r=t[t.length-1],u=new CKEDITOR.dom.node(r.target).getPage();CKEDITOR.MutationRepo.runCommandByTagName(CKEDITOR.MutationRepoType.childListAll,"*",u)}}function t(n){this.editor=n;const t=[],i=[],u=[],f=[],r=[];this.addToRepo=function(n,e){e.priority||(e.priority=10);switch(n){case 0:t.push(e);break;case 1:i.push(e);break;case 2:u.push(e);break;case 3:f.push(e);break;case 4:r.push(e);break;case 5:t.push(e);i.push(e);r.push(e)}};this.getCommandRepo=function(n){const e=function(n,t){return n.priority-t.priority};switch(n){case 0:return t.sort(e);case 1:return i.sort(e);case 2:return u.sort(e);case 3:return f.sort(e);case 4:return r.sort(e);default:return null}};this.runCommandByTagName=function(n,t,i){const f=function(n,t){return n.reduce(function(n,i){return(n[i[t]]=n[i[t]]||[]).push(i),n},{})};if(i){const r=this.getCommandRepo(n);if(r){const e=this.editor,o=f(r,"tagName"),u=o[t];u&&u.forEach(function(n){e.execCommand(n.command,i)})}}}}CKEDITOR.plugins.add("gdeditormutation",{requires:"gdeditor",init:function(n){CKEDITOR.MutationRepo=new t(n);n.addCommand("newEmptyTr",new CKEDITOR.emptyTr);n.addCommand("pageNumber",new CKEDITOR.pageNumber);n.on("contentDom",function(n){const t=n.editor.document.findOne(`.${CKEDITOR.plugins.StructureName.DocumentMainContent}`);CKEDITOR.MutationObserver.init(t);CKEDITOR.MutationObserver.disconnect()},null,null,10);n.on("afterCommandExec",function(n){if(n.data.name==="undo"){const t=n.editor.document.findOne(`.${CKEDITOR.plugins.StructureName.DocumentMainContent}`);CKEDITOR.MutationObserver.init(t)}if(n.data.name==="redo"){const t=n.editor.document.findOne(`.${CKEDITOR.plugins.StructureName.DocumentMainContent}`);CKEDITOR.MutationObserver.init(t)}})},afterInit:function(){CKEDITOR.MutationRepo.addToRepo(CKEDITOR.MutationRepoType.toAll,{tagName:"tr",command:"newEmptyTr",priority:5})}});CKEDITOR.MutationRepoType={attributes:0,characterData:1,childListAdd:2,childListRemove:3,childListAll:4,toAll:5};CKEDITOR.emptyTr=function(){};CKEDITOR.emptyTr.prototype={exec:function(n,t){if(t&&t.getName()==="tr"){const i=t.getFirst();i||t.appendHtml("&nbsp;");i.getName()==="br"&&(i.remove(),t.appendHtml("&nbsp;"))}}};CKEDITOR.pageNumber=function(){};CKEDITOR.pageNumber.prototype={exec:function(n){const t=n.document,i=t.findOne(`.${CKEDITOR.plugins.StructureName.DocumentMainContent}`);for(let n=0,t=i.find(`.${CKEDITOR.plugins.StructureName.SectionClass}`);n<t.count();n++){const i=t.getItem(n);for(let t=0,r=i.find(`.${CKEDITOR.plugins.StructureName.PageNumber}`);t<r.count();t++)r.getItem(t).textContent=n+1;for(let n=0,r=i.find(`.${CKEDITOR.plugins.StructureName.PageNumberAll}`);n<r.count();n++)r.getItem(n).textContent=t.count()}}};CKEDITOR.MutationObserver=new MutationObserver(n);MutationObserver.prototype.init=function(n){this.targetHtml=n;this.observe(n.$,CKEDITOR.config.mutationConfig)};CKEDITOR.tools.extend(CKEDITOR.config,{mutationConfig:{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0,characterData:!0,characterDataOldValue:!0,attributeFilter:["style","class"]}});CKEDITOR.dom.node.prototype.getAllChildNodes=function(){let n=[];if(this.type===3)return n;for(let i=this.getChildren(),t=0;t<i.count();t++){const r=i.getItem(t),u=r.type;(u===1||u===9||u===11)&&(n.push(r),n=n.concat(r.getAllChildNodes()))}return n};CKEDITOR.dom.node.prototype.getPage=function(){return this.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass,this.type!==3)}})();