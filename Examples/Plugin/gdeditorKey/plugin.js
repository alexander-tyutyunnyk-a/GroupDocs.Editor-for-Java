"use strict";(function(){CKEDITOR.plugins.add("gdeditorKey",{requires:"gdeditor",init:function(n){n.addCommand("afterEnter",new CKEDITOR.afterEnter);n.addCommand("splitSection",new CKEDITOR.splitSection);n.setKeystroke(CKEDITOR.CTRL+CKEDITOR.plugins.key.Enter,"splitSection");n.on("contentDom",function(){function t(t){const r=t.keyCode,i=n.getSelection();r===CKEDITOR.plugins.key.BackSpace&&i.isFirstOnPage()&&(t.preventDefault(),i.movePrevPageBackSpace());r===CKEDITOR.plugins.key.Delete&&i.isLastOnPage()&&(t.preventDefault(),i.moveNextPageDelete())}n.document.$.addEventListener("keydown",t,{capture:!0});n.document.$.addEventListener("keyup",t=>{const i=t.keyCode,r=n.getSelection();i===CKEDITOR.plugins.key.RightArrow&&r.moveNextPage();i===CKEDITOR.plugins.key.LeftArrow&&r.movePrevPage();i===CKEDITOR.plugins.key.Enter&&n.execCommand("afterEnter")})},null,null,1)}});CKEDITOR.plugins.key={Enter:13,RightArrow:39,LeftArrow:37,Delete:46,BackSpace:8,Esc:27,Q:81,A:65};CKEDITOR.splitSection=function(){};CKEDITOR.splitSection.prototype={exec:function(n){const r=n.getSelection(),o=r.anchorNode(),u=o.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass);if(u){const c=u.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0),t=n.createRange(),f=r.getNative();f?t.setStart(new CKEDITOR.dom.node(f.anchorNode),f.anchorOffset):t.setStartAt(o,CKEDITOR.POSITION_AFTER_START);t.setEndAt(c,CKEDITOR.POSITION_BEFORE_END);t.optimize();const e=t.extractContents();if(e&&e.getChildCount()!==0){const l=new CKEDITOR.Page(n,u),s=l.clonePage(),i=s.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`);e.appendTo(i);const h=new CKEDITOR.dom.element("span");h.addClass(CKEDITOR.plugins.StructureName.SectionSeparator);h.insertBefore(s);t.setStartAt(i,CKEDITOR.POSITION_AFTER_START);t.setEndAt(i,CKEDITOR.POSITION_AFTER_START);t.collapse();r.selectRanges([t]);i.scrollIntoView(!0)}}}};CKEDITOR.afterEnter=function(){};CKEDITOR.afterEnter.prototype={exec:function(n){const i=n.getSelection();let t=i.anchorNode();if(t=t.getAscendantByParentClass(CKEDITOR.plugins.StructureName.ContentClass),t){if(t.hasClass(CKEDITOR.plugins.StructureName.SplitedFirst)){const n=t.getPrevious();n&&n.removeClass(CKEDITOR.plugins.StructureName.SplitedFirst)}t.hasClass(CKEDITOR.plugins.StructureName.SplitedEnd)&&t.removeClass(CKEDITOR.plugins.StructureName.SplitedEnd)}}};CKEDITOR.dom.selection.prototype.anchorNode=function(){const n=this.getNative();return n?new CKEDITOR.dom.node(n.anchorNode):this.getSelectedElement()};CKEDITOR.dom.selection.prototype.moveNextPage=function(){const n=this.anchorNode();if(n){const t=n.type!==3,i=n.getAscendantByClass(CKEDITOR.plugins.StructureName.FootnoteClass,t)||n.getAscendantByClass(CKEDITOR.plugins.StructureName.FooterClass,t);if(i){let n=i.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass,!0);if(!n)return;if(n=n.getNext(),!n)return;if(n.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator)&&(n=n.getNext(),!n))return;let t=n.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);if(!t)return;if(t=t.getFirst(),!t)return;const r=new CKEDITOR.dom.range(this.document);r.setStartAt(t,CKEDITOR.POSITION_AFTER_START);r.collapse();this.selectRanges([r]);t.scrollIntoView(!0)}}};CKEDITOR.dom.selection.prototype.movePrevPage=function(){const n=this.anchorNode();if(n){const i=n.type!==3,t=n.getAscendantByClass(CKEDITOR.plugins.StructureName.HeaderClass,i);if(t){let n=t.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass,!0);if(!n)return;if(n=n.getPrevious(),!n)return;if(n.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator)&&(n=n.getPrevious(),!n))return;let i=n.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);if(!i)return;if(i=i.getLast(),!i)return;const r=new CKEDITOR.dom.range(this.document);r.setStartAt(i,CKEDITOR.POSITION_BEFORE_END);r.collapse();this.selectRanges([r]);i.scrollIntoView(!0)}}};CKEDITOR.dom.selection.prototype.moveNextPageDelete=function(){const n=this.anchorNode();if(n){const o=n.type!==3,u=n.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass,o);if(!u)return;const e=u.data(CKEDITOR.plugins.DataSetName.PageType);let i=u.getNext();if(!i)return;if(i.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator)){if(i.remove(),i=u.getNext(),!i)return;if(e){let n=i;while(!n.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator))n.data(CKEDITOR.plugins.DataSetName.PageType,e),n=n.getNext()}}let t=i.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);if(!t)return;if(t=t.getFirst(),!t)return;const r=new CKEDITOR.dom.range(this.document);if(t.getName()==="table")r.setStartAt(t,CKEDITOR.POSITION_BEFORE_START),r.setEndAt(t,CKEDITOR.POSITION_AFTER_END);else{const n=t.getTextNodeOne();n&&n.getText().length!==0?(r.setStart(n,1),r.setEndAt(t,CKEDITOR.POSITION_BEFORE_END)):(r.setStartAt(t,CKEDITOR.POSITION_AFTER_START),r.setEndAt(t,CKEDITOR.POSITION_BEFORE_END))}const s=r.extractContents();let f=u.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);f=f.getLast();f.append(s);t.remove()}};CKEDITOR.dom.selection.prototype.movePrevPageBackSpace=function(){const n=this.anchorNode();if(n){const h=n.type!==3,e=n.getAscendantByClass(CKEDITOR.plugins.StructureName.SectionClass,h);if(!e)return;const s=e.data(CKEDITOR.plugins.DataSetName.PageType);let r=e.getPrevious();if(!r)return;if(r.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator)){if(r.remove(),r=e.getPrevious(),!r)return;if(s){let n=r;while(!n.hasClass(CKEDITOR.plugins.StructureName.SectionSeparator))n.data(CKEDITOR.plugins.DataSetName.PageType,s),n=n.getNext()}}let u=e.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);if(!u)return;if(u=u.getFirst(),!u)return;const t=new CKEDITOR.dom.range(this.document);t.setStartAt(u,CKEDITOR.POSITION_AFTER_START);t.setEndAt(u,CKEDITOR.POSITION_BEFORE_END);const c=t.extractContents();let f=r.findOne(`.${CKEDITOR.plugins.StructureName.ContentClass}`,!0);f=f.getLast();const o=f.getLast();o&&(o.getName()==="br"||o.getName()==="img")&&o.remove();const i=f.getTextNodeLast();i?(i.setText(i.substring(0,i.getLength()-1)),t.setStart(i,i.getLength()),t.setEnd(i,i.getLength()),t.collapse()):(t.setStartAt(f,CKEDITOR.POSITION_BEFORE_END),t.setEndAt(f,CKEDITOR.POSITION_BEFORE_END),t.collapse());f.append(c);this.selectRanges([t]);u.remove()}};CKEDITOR.dom.selection.prototype.isLastOnPage=function(){const i=this._.cache;this.getStartElement();const t=i.selectedElement;if(t){if(t.getNext())return!1;let n=t.getParent();while(n){const t=n.getParent();if(!t)return!1;if(t.hasClass(CKEDITOR.plugins.StructureName.ContentClass))return!n.getNext();if(n.getNext())return!1;n=t}}const n=i.startElement;if(n){if(n.getNext())return!1;const i=this.getNative();if(!i)return!1;const u=new CKEDITOR.dom.node(i.anchorNode),r=i.anchorNode.length;if(i.anchorOffset!==r&&i.anchorOffset+1===r&&u.getText()[r-1]===" ")return!1;let t=n.getParent();if(t.hasClass(CKEDITOR.plugins.StructureName.ContentClass))return!n.getNext();while(t){const n=t.getParent();if(!n)return!1;if(n.hasClass(CKEDITOR.plugins.StructureName.ContentClass))return!t.getNext();if(t.getNext())return!1;t=n}}return!1};CKEDITOR.dom.selection.prototype.isFirstOnPage=function(){const t=this.getNative();if(!t)return this.getSelectedElement().hasClass("footnotesCommon")?!1:!0;const i=new CKEDITOR.dom.node(t.anchorNode);if(i.type!==3||t.anchorOffset!==0)return!1;let n=i.getParent();while(n&&n.type!==9){if(n.getPrevious())return!1;if(n=n.getParent(),n.hasClass(CKEDITOR.plugins.StructureName.ContentClass))return!0}return!1};CKEDITOR.dom.node.prototype.hasAncestorByClass=function(n){let t=this;for(t.type===3&&(t=t.getParent());t&&t.type!==9;){if(t.hasClass(n))return!1;if(t=t.getParent(),t.hasClass(n))return!0}return!1};CKEDITOR.dom.node.prototype.getAscendantByParentClass=function(n){let t=this;for(this.type===3&&(t=t.getParent());t&&t.type!==9;){if(t.hasClass(n))return null;const i=t.getParent();if(i.hasClass(n))return t;t=i}return null};CKEDITOR.dom.node.prototype.getAscendantByClass=function(n,t){return this.getAscendant(function(t){return t&&t.type!==9&&t.type!==11?t.hasClass(n):null},t)}})();